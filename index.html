<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CE„Çπ„Ç±„Ç∏„É•„Éº„É´ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† Ver.1</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #E8F5E8 0%, #D4F1D4 100%);
            --accent-color: #B8E6B8;
            --text-color: #2C3E50;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        body {
            background: var(--primary-gradient);
            font-family: 'Segoe UI', 'Hiragino Sans', 'Yu Gothic UI', sans-serif;
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glassmorphism {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .btn-primary:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 6px 18px rgba(0,0,0,0.15); 
        }

        .ce-item {
            background: linear-gradient(135deg, var(--ce-color), var(--ce-color-light));
            border-radius: 10px;
            padding: 8px 10px;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 1px 6px rgba(0,0,0,0.08);
            font-size: 12px;
            cursor: grab;
            position: relative;
        }

        .ce-item.worktype-ope { --ce-color:#87CEEB; --ce-color-light:#B0E0E6; color:#1E3A8A;}
        .ce-item.worktype-me { --ce-color:#90EE90; --ce-color-light:#98FB98; color:#006400;}
        .ce-item.worktype-hd { --ce-color:#FFB6C1; --ce-color-light:#FFC0CB; color:#8B008B;}
        .ce-item.worktype-flex { --ce-color:#FFFF99; --ce-color-light:#FFFFE0; color:#B8860B;}

        .status-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: #4CAF50;
            color: white;
            font-size: 8px;
            padding: 1px 3px;
            border-radius: 3px;
            font-weight: bold;
        }

        .status-Êó© { background: #FF9800; }
        .status-ÂΩì { background: #9C27B0; }
        .status-Èùû { background: #607D8B; }
        .status-‰ºë { background: #F44336; }
        .status-Âá∫ { background: #2196F3; }

        .sidebar {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255,255,255,0.3);
            min-height: 100vh;
            transition: all 0.3s ease;
            width: 60px;
            overflow: hidden;
        }

        .sidebar.expanded {
            width: 256px;
        }

        .sidebar-text {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar.expanded .sidebar-text {
            opacity: 1;
        }

        .sync-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 700;
        }

        .sync-indicator.connected { 
            background: rgba(76,175,80,0.1); 
            color: #2E7D32; 
        }

        .sync-indicator.disconnected { 
            background: rgba(244,67,54,0.1); 
            color: #C62828; 
        }

        .sync-indicator.connecting { 
            background: rgba(255,193,7,0.1); 
            color: #F57C00; 
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .sync-dot.pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .message {
            padding: 10px 14px;
            border-radius: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 2000;
            box-shadow: var(--shadow);
        }

        .message.success { background: rgba(76,175,80,0.95); color: #fff; }
        .message.error { background: rgba(244,67,54,0.95); color: #fff; }
        .message.info { background: rgba(33,150,243,0.95); color: #fff; }
        .message.warning { background: rgba(255,193,7,0.95); color: #111; }

        @media print {
            .sidebar, .message { display: none !important; }
            body { background: white !important; }
        }
    </style>
</head>
<body>
    <div id="messageContainer"></div>

    <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center">
        <div class="glassmorphism rounded-2xl p-8 w-full max-w-md shadow-2xl">
            <div class="text-center mb-6">
                <i class="fas fa-hospital text-4xl text-green-600 mb-3"></i>
                <h1 class="text-2xl font-bold text-gray-800 mb-1">CE„Çπ„Ç±„Ç∏„É•„Éº„É´ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† Ver.1</h1>
                <p class="text-gray-600 text-sm">GitHub Pages + Firebase „É™„Ç¢„É´„Çø„Ç§„É†ÂêåÊúü</p>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">„É¶„Éº„Ç∂„Éº</label>
                    <select id="userId" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        <option value="">„É¶„Éº„Ç∂„Éº„ÇíÈÅ∏Êäû</option>
                        <option value="„Çπ„Çø„ÉÉ„Éï">„Çπ„Çø„ÉÉ„Éï</option>
                        <option value="ÊâãË°ì„ÉªÈ∫ªÈÖî">ÊâãË°ì„ÉªÈ∫ªÈÖî</option>
                        <option value="ME„Çª„É≥„Çø„Éº">ME„Çª„É≥„Çø„Éº</option>
                        <option value="Ë°ÄÊ∂≤ÊµÑÂåñ">Ë°ÄÊ∂≤ÊµÑÂåñ</option>
                        <option value="‰∏çÊï¥ËÑà">‰∏çÊï¥ËÑà</option>
                        <option value="‰∫∫Â∑•ÂøÉËÇ∫„ÉªË£úÂä©Âæ™Áí∞">‰∫∫Â∑•ÂøÉËÇ∫„ÉªË£úÂä©Âæ™Áí∞</option>
                        <option value="ÂøÉ„Éª„Ç´„ÉÜ„Éº„ÉÜ„É´">ÂøÉ„Éª„Ç´„ÉÜ„Éº„ÉÜ„É´</option>
                        <option value="„É¢„Éã„Çø„Éº">„É¢„Éã„Çø„Éº</option>
                        <option value="ÁÆ°ÁêÜËÄÖ">ÁÆ°ÁêÜËÄÖ</option>
                    </select>
                </div>

                <div id="nameInputDiv" style="display:none;">
                    <label class="block text-sm font-medium text-gray-700 mb-2">„ÅäÂêçÂâç</label>
                    <input id="nameInput" type="text" placeholder="„ÅäÂêçÂâç„ÇíÂÖ•Âäõ" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"/>
                </div>

                <div id="securityCodeDiv" style="display:none;">
                    <label class="block text-sm font-medium text-gray-700 mb-2">„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç≥„Éº„Éâ</label>
                    <input id="securityInput" type="password" placeholder="„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"/>
                </div>

                <button id="loginButton" class="btn-primary w-full">
                    <i class="fas fa-sign-in-alt mr-2"></i>„É≠„Ç∞„Ç§„É≥
                </button>

                <div class="text-center">
                    <div id="syncStatus" class="sync-indicator connecting">
                        <div class="sync-dot pulse"></div>FirebaseÊé•Á∂ö‰∏≠...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- „É°„Ç§„É≥ÁîªÈù¢ÔºàÁ∞°Áï•Áâà - Âãï‰ΩúÁ¢∫Ë™çÁî®Ôºâ -->
    <div id="mainInterface" style="display:none;" class="flex">
        <div id="sidebar" class="sidebar p-4">
            <div class="mb-3 flex justify-between items-center">
                <button id="toggleSidebar" class="p-2 rounded-lg hover:bg-gray-200">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="text-xs text-gray-600 sidebar-text">
                    <span id="currentUserDisplay">„É¶„Éº„Ç∂„Éº</span>
                </div>
            </div>
            <div id="mainSyncStatus" class="sync-indicator connected">
                <div class="sync-dot pulse"></div>
                <span class="sidebar-text">ÂêåÊúü‰∏≠</span>
            </div>
        </div>
        
        <div class="flex-1 p-4">
            <h2 class="text-2xl font-bold mb-4">„É≠„Ç∞„Ç§„É≥ÊàêÂäüÔºÅ</h2>
            <p class="text-gray-600 mb-4">CE„Çπ„Ç±„Ç∏„É•„Éº„É´ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† Ver.1 „ÅåÊ≠£Â∏∏„Å´Âãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ</p>
            <div class="glassmorphism rounded-2xl p-6">
                <h3 class="text-lg font-bold mb-2">„Ç∑„Çπ„ÉÜ„É†Áä∂Ê≥Å</h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <p>„É¶„Éº„Ç∂„Éº: <span class="font-bold text-green-600" id="userDisplay"></span></p>
                        <p>„É≠„Éº„É´: <span class="font-bold" id="roleDisplay"></span></p>
                        <p>Firebase: <span class="font-bold text-green-600">Êé•Á∂ö‰∏≠</span></p>
                    </div>
                    <div>
                        <p>„Éê„Éº„Ç∏„Éß„É≥: <span class="font-bold">Ver.1</span></p>
                        <p>„Éõ„Çπ„ÉÜ„Ç£„É≥„Ç∞: <span class="font-bold">GitHub Pages</span></p>
                        <p>Áä∂ÊÖã: <span class="font-bold text-green-600">Ê≠£Â∏∏Á®ºÂÉç‰∏≠</span></p>
                    </div>
                </div>
            </div>
            <button id="logoutButton" class="btn-primary mt-4">
                <i class="fas fa-sign-out-alt mr-2"></i>„É≠„Ç∞„Ç¢„Ç¶„Éà
            </button>
        </div>
    </div>

    <script>
        // ========= Firebase Ë®≠ÂÆö =========
        // üî• ÈáçË¶Å: ‰ª•‰∏ã„ÇíFirebase Console„Åã„ÇâÂèñÂæó„Åó„ÅüÂÆüÈöõ„ÅÆÂÄ§„Å´ÁΩÆ„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑ
        const firebaseConfig = {
            apiKey: "AIzaSyBpfRTPDFFTEkWtuvksoF_hVkftQ__wH8Q",
  „ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄauthDomain: "ce-scheduling-system.firebaseapp.com",
  „ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄdatabaseURL: "https://ce-scheduling-system-default-rtdb.asia-southeast1.firebasedatabase.app",
„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ  projectId: "ce-scheduling-system",
  „ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄstorageBucket: "ce-scheduling-system.firebasestorage.app",
  „ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄmessagingSenderId: "401096569342",
  „ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄappId: "1:401096569342:web:03b0a5f5bfd09e34ae90af",
 „ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ measurementId: "G-8C7X5WCED3"
„ÄÄ„ÄÄ„ÄÄ„ÄÄ};

        // ========= „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞ =========
        let database = null;
        let auth = null;
        let isFirebaseReady = false;
        let currentUser = null;
        let userRole = null;

        // Ë™çË®ºË®≠ÂÆö
        const AUTH_CREDENTIALS = {
            '„Çπ„Çø„ÉÉ„Éï': { type: 'name', role: 'viewer' },
            'ÊâãË°ì„ÉªÈ∫ªÈÖî': { code: 'secure_SurgAnest_6917_ce_system', role: 'editor' },
            'ME„Çª„É≥„Çø„Éº': { code: 'secure_MEcenter_6994_ce_system', role: 'editor' },
            'Ë°ÄÊ∂≤ÊµÑÂåñ': { code: 'secure_Hemodialysis_6735_ce_system', role: 'editor' },
            '‰∏çÊï¥ËÑà': { code: 'secure_Arrhythm_6551_ce_system', role: 'editor' },
            '‰∫∫Â∑•ÂøÉËÇ∫„ÉªË£úÂä©Âæ™Áí∞': { code: 'secure_CpbEcmo_6288_ce_system', role: 'editor' },
            'ÂøÉ„Éª„Ç´„ÉÜ„Éº„ÉÜ„É´': { code: 'secure_CardCath_6925_ce_system', role: 'editor' },
            '„É¢„Éã„Çø„Éº': { code: 'secure_CEmonitor_1122_ce_system', role: 'monitor' },
            'ÁÆ°ÁêÜËÄÖ': { code: 'secure_CEadmin_5711_ce_system', role: 'admin' }
        };

        // ========= ÂàùÊúüÂåñ =========
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeSystem);
        } else {
            initializeSystem();
        }

        function initializeSystem() {
            console.log('üîÑ „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÈñãÂßã');
            try {
                setupAllEventListeners();
                initializeFirebase();
                restoreLoginState();
                console.log('‚úÖ „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫Ü');
            } catch (error) {
                console.error('‚ùå ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                showMessage('„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // ========= FirebaseÂàùÊúüÂåñ =========
        function initializeFirebase() {
            try {
                updateSyncStatus('connecting', 'FirebaseÊé•Á∂ö‰∏≠...');
                
                // Ë®≠ÂÆöÂÄ§Ê§úË®º
                if (firebaseConfig.messagingSenderId.includes('YOUR_') || firebaseConfig.appId.includes('YOUR_')) {
                    console.warn('‚ö†Ô∏è FirebaseË®≠ÂÆöÂÄ§„ÅåÊú™Ë®≠ÂÆö„Åß„Åô');
                    updateSyncStatus('disconnected', 'FirebaseË®≠ÂÆöÊú™ÂÆå‰∫Ü');
                    showMessage('FirebaseË®≠ÂÆöÂÄ§„ÇíÊõ¥Êñ∞„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                    return;
                }

                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                database = firebase.database();
                auth = firebase.auth();

                // Êé•Á∂öÁõ£Ë¶ñ
                database.ref('.info/connected').on('value', function(snapshot) {
                    if (snapshot.val() === true) {
                        console.log('‚úÖ FirebaseÊé•Á∂öÊàêÂäü');
                        updateSyncStatus('connected', '„É™„Ç¢„É´„Çø„Ç§„É†ÂêåÊúü‰∏≠');
                        isFirebaseReady = true;
                    } else {
                        console.log('‚ùå FirebaseÊé•Á∂öÂ§±Êïó');
                        updateSyncStatus('disconnected', 'Êé•Á∂öÂ§±Êïó');
                        isFirebaseReady = false;
                    }
                });

                // ÂåøÂêçË™çË®º
                auth.signInAnonymously()
                    .then(() => {
                        console.log('‚úÖ FirebaseÂåøÂêçË™çË®ºÊàêÂäü');
                    })
                    .catch((error) => {
                        console.error('‚ùå FirebaseË™çË®º„Ç®„É©„Éº:', error);
                        updateSyncStatus('disconnected', 'Ë™çË®ºÂ§±Êïó');
                        showMessage('FirebaseË™çË®º„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                    });

            } catch (error) {
                console.error('‚ùå FirebaseÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                updateSyncStatus('disconnected', 'ÂàùÊúüÂåñÂ§±Êïó');
                showMessage('FirebaseÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // ========= „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö =========
        function setupAllEventListeners() {
            // „É¶„Éº„Ç∂„ÉºIDÂ§âÊõ¥
            document.getElementById('userId').addEventListener('change', handleUserIdChange);
            document.getElementById('userId').addEventListener('input', handleUserIdChange);
            
            // „É≠„Ç∞„Ç§„É≥
            document.getElementById('loginButton').addEventListener('click', handleLogin);
            document.getElementById('securityInput').addEventListener('keypress', e => { 
                if (e.key === 'Enter') handleLogin(); 
            });
            document.getElementById('nameInput').addEventListener('keypress', e => { 
                if (e.key === 'Enter') handleLogin(); 
            });

            // „Çµ„Ç§„Éâ„Éê„Éº
            document.getElementById('toggleSidebar').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('expanded');
            });

            // „É≠„Ç∞„Ç¢„Ç¶„Éà
            document.getElementById('logoutButton').addEventListener('click', handleLogout);
        }

        // ========= „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ =========
        function handleUserIdChange() {
            const userId = document.getElementById('userId').value;
            const nameDiv = document.getElementById('nameInputDiv');
            const secDiv = document.getElementById('securityCodeDiv');
            
            if (userId === '„Çπ„Çø„ÉÉ„Éï') {
                nameDiv.style.display = 'block';
                secDiv.style.display = 'none';
            } else if (userId) {
                nameDiv.style.display = 'none';
                secDiv.style.display = 'block';
            } else {
                nameDiv.style.display = 'none';
                secDiv.style.display = 'none';
            }
        }

        function handleLogin() {
            const userId = document.getElementById('userId').value;
            const nameInput = document.getElementById('nameInput').value.trim();
            const securityInput = document.getElementById('securityInput').value;

            if (!userId) {
                showMessage('„É¶„Éº„Ç∂„Éº„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                return;
            }

            const credential = AUTH_CREDENTIALS[userId];
            if (!credential) {
                showMessage('ÁÑ°Âäπ„Å™„É¶„Éº„Ç∂„Éº„Åß„Åô', 'error');
                return;
            }

            let isValid = false;
            let displayName = userId;
            
            if (credential.type === 'name') {
                if (!nameInput) {
                    showMessage('„ÅäÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                    return;
                }
                isValid = true;
                displayName = nameInput;
            } else {
                if (!securityInput) {
                    showMessage('„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                    return;
                }
                isValid = securityInput === credential.code;
            }

            if (isValid) {
                userRole = credential.role;
                currentUser = displayName;
                
                // „É≠„Ç∞„Ç§„É≥Áä∂ÊÖã‰øùÂ≠òÔºà24ÊôÇÈñìÊúâÂäπÔºâ
                const loginExpiry = Date.now() + (24 * 60 * 60 * 1000);
                localStorage.setItem('ceSystemLoggedInUser', JSON.stringify({
                    id: currentUser,
                    role: userRole,
                    loginTime: new Date().toISOString()
                }));
                localStorage.setItem('ceSystemLoginExpiry', loginExpiry.toString());
                
                showMainInterface();
                showMessage(`${userId}„Å®„Åó„Å¶„É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åó„Åü`, 'success');
            } else {
                showMessage('Ë™çË®º„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        function handleLogout() {
            if (confirm('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü')) {
                currentUser = null;
                userRole = null;
                
                localStorage.removeItem('ceSystemLoggedInUser');
                localStorage.removeItem('ceSystemLoginExpiry');
                
                document.getElementById('mainInterface').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                
                // „Éï„Ç©„Éº„É†„É™„Çª„ÉÉ„Éà
                document.getElementById('userId').value = '';
                document.getElementById('nameInput').value = '';
                document.getElementById('securityInput').value = '';
                handleUserIdChange();
                
                showMessage('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü', 'info');
            }
        }

        function restoreLoginState() {
            try {
                const savedUser = localStorage.getItem('ceSystemLoggedInUser');
                const loginExpiry = localStorage.getItem('ceSystemLoginExpiry');
                
                if (savedUser && loginExpiry) {
                    const currentTime = Date.now();
                    const expiryTime = parseInt(loginExpiry);
                    
                    if (currentTime < expiryTime) {
                        const parsedUser = JSON.parse(savedUser);
                        currentUser = parsedUser.id;
                        userRole = parsedUser.role;
                        showMainInterface();
                        showMessage(`„ÅäÁñ≤„ÇåÊßò„Åß„Åô„ÄÅ${currentUser}„Åï„ÇìÔºÅ`, 'info');
                        return;
                    } else {
                        localStorage.removeItem('ceSystemLoggedInUser');
                        localStorage.removeItem('ceSystemLoginExpiry');
                    }
                }
                
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainInterface').style.display = 'none';
            } catch (error) {
                console.error('‚ùå „É≠„Ç∞„Ç§„É≥Áä∂ÊÖãÂæ©ÂÖÉ„Ç®„É©„Éº:', error);
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainInterface').style.display = 'none';
            }
        }

        function showMainInterface() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainInterface').style.display = 'flex';
            
            document.getElementById('currentUserDisplay').textContent = currentUser;
            document.getElementById('userDisplay').textContent = currentUser;
            document.getElementById('roleDisplay').textContent = userRole;
        }

        // ========= „Éò„É´„Éë„ÉºÈñ¢Êï∞ =========
        function updateSyncStatus(status, message) {
            const syncStatus = document.getElementById('syncStatus');
            const mainSyncStatus = document.getElementById('mainSyncStatus');
            
            const statusClasses = {
                'connecting': 'sync-indicator connecting',
                'connected': 'sync-indicator connected',
                'disconnected': 'sync-indicator disconnected'
            };
            
            if (syncStatus) {
                syncStatus.className = statusClasses[status] || 'sync-indicator disconnected';
                syncStatus.innerHTML = `<div class="sync-dot ${status === 'connected' ? 'pulse' : ''}"></div>${message}`;
            }
            
            if (mainSyncStatus) {
                mainSyncStatus.className = statusClasses[status] || 'sync-indicator disconnected';
                mainSyncStatus.innerHTML = `<div class="sync-dot ${status === 'connected' ? 'pulse' : ''}"></div><span class="sidebar-text">${message}</span>`;
            }
        }

        function showMessage(text, type = 'info') {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const icons = {
                success: 'check',
                error: 'times',
                warning: 'exclamation',
                info: 'info'
            };
            
            messageDiv.innerHTML = `
                <i class="fas fa-${icons[type]}-circle"></i>
                ${text}
            `;
            
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 4000);
        }
    </script>
</body>
</html>
